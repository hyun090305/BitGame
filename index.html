<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Bit Game</title>
    <link rel="stylesheet" href="style.v1.4.css">
    <style>
    html {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap"
      rel="stylesheet" />
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body>
    <div id="usernameModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2>ë‹‰ë„¤ì„ ì„¤ì •</h2>
        <p class="info-text">ì´ ë‹‰ë„¤ì„ì€ ë­í‚¹ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
        <p class="info-text">ë‹‰ë„¤ì„ì€ ë°”ê¿€ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        <input type="text" id="usernameInput" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„ ì…ë ¥" />
        <div id="usernameError" style="color:red; margin-top:0.5rem;"></div>
        <button id="usernameSubmit">í™•ì¸</button>
      </div>
    </div>
    <!-- ë©”ì¸ í™”ë©´ -->
    <div class="container" id="firstScreen">
      <div id="overallRankingArea">
        <h3>ğŸ† ì „ì²´ ë­í‚¹</h3>
        <div id="overallRankingList">ë¡œë”© ì¤‘â€¦</div>
      </div>
      <div id="mainScreen">
        <h1>ğŸ§  Bit Game</h1>
        <button id="startBtn">ì‹œì‘í•˜ê¸°</button>
        <button id="tutorialBtn">ğŸ“– íŠœí† ë¦¬ì–¼</button>
        <div></div>
        <button id="manageModulesBtn">ëª¨ë“ˆ ê´€ë¦¬</button>
        <div></div>
        <button id="copyStatusBtn">ğŸ“‹ ê³µìœ í•˜ê¸°</button>
      </div>
      <div id="guestbookArea">
        <h3>ğŸ“ ê°œë°œì(ì´í˜„ì¤€)í•œí…Œ ê¸€ ë‚¨ê¸°ê¸°</h3>
        <p class="info-text">ë‹‰ë„¤ì„: <b id="guestUsername"></b></p>
        <br>
        <textarea id="guestMessage" rows="4"
          placeholder="ë‚¨ê¸°ê³  ì‹¶ì€ ë§..."></textarea>
        <br>
        <button onclick="submitGuestEntry()">ë“±ë¡</button>

        <div id="guestbookList"></div>
        <button id="coffeeBtn" style="margin-top:16px;">
          â˜• ê°œë°œì(ì´í˜„ì¤€)í•œí…Œ ì»¤í”¼ ì‚¬ì£¼ê¸°
        </button>
        <div id="shareModal" class="modal" style="display:none;">
          <div class="modal-content">
            <h3>ğŸ”— ê³µìœ í•  ë‚´ìš©</h3>
            <textarea id="shareText" readonly rows="20"
              style="width:100%;"></textarea>
            <div style="margin-top:1rem; text-align:right;">
              <button id="copyShareBtn">ë³µì‚¬í•˜ê¸°</button>
              <button id="closeShareBtn">ë‹«ê¸°</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="module-management-screen" class="screen module-management-screen"
      style="display:none;">
      <button id="backToMainFromManagement" class="btn-back">â† ë©”ì¸ìœ¼ë¡œ</button>
      <h1 class="screen-title">ğŸ“¦ ëª¨ë“ˆ ê´€ë¦¬</h1>

      <ul id="moduleList" class="module-list">
        <!--
      JSì—ì„œ ì´ë ‡ê²Œ ìƒì„±ë©ë‹ˆë‹¤:
      <li class="module-item">
        <span class="module-name">ëª¨ë“ˆì´ë¦„</span>
        <button class="btn-load">ë¶ˆëŸ¬ì˜¤ê¸°</button>
      </li>
    -->
      </ul>

      <button id="createModuleBtn" class="btn-primary">+ ìƒˆ ëª¨ë“ˆ ë§Œë“¤ê¸°</button>
    </div>
    <div id="module-editor-screen" style="display:none; padding:2rem;">
      <!-- ì œëª© -->
      <h1 id="moduleTitle">ğŸ›  ëª¨ë“ˆ ì œì‘ ëª¨ë“œ</h1>

      <!-- ì „ì²´ ë ˆì´ì•„ì›ƒ: ì¢Œì¸¡ ë¸”ë¡ íŒ¨ë„ + ì¤‘ì•™ ê·¸ë¦¬ë“œ + ìš°ì¸¡ ì•ˆë‚´ -->
      <div id="moduleLayout"
        style="display:flex; gap:1rem; align-items:flex-start;">

        <!-- ì¢Œì¸¡: ë¸”ë¡ íŒ¨ë„ -->
        <div id="moduleBlockPanel" style="width: 120px;">
          <!-- JSë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
        </div>

        <!-- ì¤‘ì•™: íšŒë¡œ ê·¸ë¦¬ë“œ -->
        <div id="moduleGridContainer" class="grid" style="position: relative;">
          <div id="moduleGrid"></div>
          <div id="moduleGridOverlay"></div>
        </div>

        <!-- ìš°ì¸¡: ì•ˆë‚´ + ì‚­ì œ -->
        <div class="rightPanel" id="moduleRightPanel"
          style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">

          <!-- â€» gradeButton ì œê±° -->

          <!-- í‚¤ ì„¤ëª… & ìƒíƒœ ë©”ì‹œì§€ -->
          <div style="text-align: center; line-height: 1.6;">
            <button id="moduleWireStatusInfo" class="toggle-key"
              style="color: darkgreen; font-weight: bold;">
              Ctrl - ë„ì„  ê·¸ë¦¬ê¸°
            </button>
            <button id="moduleWireDeleteInfo" class="toggle-key"
              style="color: crimson; font-weight: bold;">
              Shift - ë„ì„ /ë¸”ë¡ ì‚­ì œ
            </button>
            <button id="moduleDeleteAllInfo" class="toggle-key"
              style="color: crimson; font-weight: bold;">
              R - íšŒë¡œ ì´ˆê¸°í™”
            </button>
          </div>

          <!-- íœ´ì§€í†µ -->
          <div id="trash" class="trash-area" style="margin-top: 20px;">
            ğŸ—‘ï¸ Drag here to delete
          </div>
        </div>

      </div>
      <!-- (A) ëª¨ë“ˆ ì €ì¥í•˜ê¸° ë²„íŠ¼ -->
      <button id="saveModuleBtn">ëª¨ë“ˆ ì €ì¥í•˜ê¸°</button>

      <!-- (B) ëª¨ë‹¬ ì „ì²´ ì»¨í…Œì´ë„ˆ: ì´ˆê¸°ì—ëŠ” ìˆ¨ê²¨ë‘¡ë‹ˆë‹¤ -->
      <div id="moduleSaveModal" class="modal" style="display: none;">
        <!-- (B1) ë°±ë“œë¡­: ëª¨ë‹¬ ë’¤ ì–´ë‘ìš´ ë°˜íˆ¬ëª… ë°°ê²½ -->
        <div class="modal-backdrop"></div>

        <!-- (B2) ì‹¤ì œ ë‹¤ì´ì–¼ë¡œê·¸ ë°•ìŠ¤ -->
        <div class="modal-dialog">
          <h3>ëª¨ë“ˆ ì •ë³´ ì…ë ¥</h3>

          <!-- ì´ë¦„ ì…ë ¥ -->
          <input
            id="moduleNameInput"
            type="text"
            placeholder="ëª¨ë“ˆ ì´ë¦„ (ì˜ë¬¸/ìˆ«ì, ìµœëŒ€ 8ì)"
            maxlength="8"
            pattern="[A-Za-z0-9]+"
            title="ì˜ë¬¸ì(Aâ€“Z, aâ€“z)ì™€ ìˆ«ì(0â€“9)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤."
            class="modal-input" />

          <!-- ì„¤ëª… ì…ë ¥ -->
          <textarea
            id="moduleDescInput"
            placeholder="ëª¨ë“ˆ ì„¤ëª… (ì„ íƒ)"
            rows="3"
            class="modal-textarea"></textarea>

          <!-- ë²„íŠ¼ ê·¸ë£¹ -->
          <div class="modal-buttons">
            <button id="confirmSaveModuleBtn" class="btn-primary">ì €ì¥í•˜ê¸°</button>
            <button id="cancelSaveModuleBtn" class="btn-secondary">ì·¨ì†Œ</button>
          </div>
        </div>
      </div>
      <!-- ë’¤ë¡œê°€ê¸° -->
      <button id="exit-module-mode">â† ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="chapterScreen" style="display:none; padding: 2rem;">
      <h1>ğŸ“š ì±•í„° ì„ íƒ</h1>
      <div id="chapterGrid"></div>
      <button id="backToMainFromChapter">â† ë©”ì¸ìœ¼ë¡œ</button>
    </div>

    <!-- ë ˆë²¨ ì„ íƒ í™”ë©´ -->
    <div id="levelScreen" style="display:none">
      <h2>ìŠ¤í…Œì´ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
      <div class="levelGrid">
        <button class="levelBtn" data-level="1"></button>
        <button class="levelBtn" data-level="2"></button>
        <button class="levelBtn" data-level="3"></button>
        <button class="levelBtn" data-level="4"></button>
        <button class="levelBtn" data-level="5"></button>
        <button class="levelBtn" data-level="6"></button>
      </div>
      <br><br>
      <button id="backToMainBtn">â† ë©”ì¸ìœ¼ë¡œ</button>
    </div>
    <div id="rankingModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2>ğŸ† ë­í‚¹</h2>
        <div id="rankingList"></div>
      </div>
    </div>
    <!-- ê²Œì„ í™”ë©´ -->
    <div id="gameScreen" style="display:none">
      <h1 id="gameTitle">ğŸ§  Bit Game</h1>

      <!-- ì „ì²´ ê²Œì„ ì˜ì—­: ì¢Œì¸¡ ë©”ë‰´ + ì¤‘ì•™ ê·¸ë¦¬ë“œ + ìš°ì¸¡ ì•ˆë‚´ -->
      <div id="gameLayout">

        <!-- ë¸”ë¡ íŒ¨ë„ -->
        <div id="blockPanel" style="width: 120px;">
        </div>

        <!-- íšŒë¡œ ê·¸ë¦¬ë“œ -->
        <div id="gridContainer" style="position: relative;">
          <div id="grid" class="grid"></div>
          <div id="gridOverlay"></div>
        </div>

        <!-- ìš°ì¸¡: ì‹œë®¬ë ˆì´íŠ¸ + ì•ˆë‚´ + ì‚­ì œ -->
        <div class="rightPanel" id="rightPanel"
          style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
          <button id="gradeButton" class="green">ì±„ì í•˜ê¸°</button>
          <div style="text-align: center; line-height: 1.6;">
            <button id="wireStatusInfo" class="toggle-key"
              style="color: darkgreen; font-weight: bold;">
              Ctrl - ë„ì„  ê·¸ë¦¬ê¸°
            </button>
            <button id="wireDeleteInfo" class="toggle-key"
              style="color: crimson; font-weight: bold; ">
              Shift - ë„ì„ /ë¸”ë¡ ì‚­ì œ
            </button>
            <button id="DeleteAllInfo" class="toggle-key"
              style="color: crimson; font-weight: bold; ">
              R - íšŒë¡œ ì´ˆê¸°í™”
            </button>
          </div>

          <div id="trash" class="trash-area" style="margin-top: 20px;">ğŸ—‘ï¸ Drag
            here to
            delete</div>
        </div>
        <div id="gradingArea" style="display:none">
          <button id="returnToEditBtn">ğŸ›  í¸ì§‘ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      </div>
      <div id="usagePanel" style="text-align:center; margin:1rem 0;">
        ì‚¬ìš©ëœ ë¸”ë¡: <span id="usedBlocksCount">0</span>
        ì‚¬ìš©ëœ ì „ì„ : <span id="usedWiresCount">0</span>
      </div>
      <!-- ë©”ë‰´ë°” -->
      <div id="menuBar">
        <button id="prevStageBtnMenu">â† ì´ì „ ìŠ¤í…Œì´ì§€</button>
        <button id="saveCircuitBtn">ğŸ’¾ íšŒë¡œ ì €ì¥</button>
        <button id="viewSavedBtn">ğŸ’¾ ì €ì¥ëœ íšŒë¡œ ë³´ê¸°</button>
        <button id="viewRankingBtn">ğŸ† ë­í‚¹ ë³´ê¸°</button>
        <button id="showIntroBtn">â„¹ï¸ ìŠ¤í…Œì´ì§€ ì•ˆë‚´</button>
        <button id="recordBtn">ğŸ”´ ë…¹í™”</button>
        <button id="backToLevelsBtn">â† ë ˆë²¨ ì„ íƒìœ¼ë¡œ</button>
        <button id="nextStageBtnMenu">ë‹¤ìŒ ìŠ¤í…Œì´ì§€ â†’</button>

        <!-- ì¶”ê°€: ì• ë‹ˆë©”ì´ì…˜ ìº¡ì²˜(ë©”ì¸ ê·¸ë¦¬ë“œìš©) -->
        <button id="captureGifBtnMain">ğŸ–¼ï¸ ì• ë‹ˆë©”ì´ì…˜ ìº¡ì²˜</button>
      </div>
    </div>
    <div id="tutorialModal" class="modal tutorial-modal" style="display:none;">
      <div class="modal-content tutorial-content">
        <h2 id="tutTitle"></h2>
        <!-- ì—¬ê¸° ì´ë¯¸ì§€ ìë¦¬ -->
        <img id="tutImg" class="tutorial-img" src alt="íŠœí† ë¦¬ì–¼ ì´ë¯¸ì§€"
          style="display:none;">
        <p id="tutDesc"></p>
        <div class="tut-controls">
          <button id="tutPrevBtn">ì´ì „</button>
          <button id="tutNextBtn">ë‹¤ìŒ</button>
          <button id="tutCloseBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <!-- ì €ì¥ëœ íšŒë¡œ ëª©ë¡ ëª¨ë‹¬ -->
    <div id="savedModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2>ğŸ’¾ ì €ì¥ëœ íšŒë¡œ ëª©ë¡</h2>
        <ul id="savedList"
          style="list-style:none; padding:0; max-height:300px; overflow-y:auto;">
          <!-- ì—¬ê¸°ì— JSë¡œ <li>ë“¤ì´ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
        </ul>
        <div style="text-align:right; margin-top:1rem;">
          <button id="closeSavedModal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
    <div id="clearedModal" class="modal" style="display: none;">
      <div class="modal-content">
        <h2>ìŠ¤í…Œì´ì§€ <span id="clearedStageNumber"></span> í´ë¦¬ì–´!</h2>
        <div id="clearedRanking"></div>
        <div class="modal-buttons">
          <button id="prevStageBtn">ì´ì „ ìŠ¤í…Œì´ì§€</button>
          <button id="nextStageBtn">ë‹¤ìŒ ìŠ¤í…Œì´ì§€</button>
        </div>
        <button class="closeBtn">&times;</button>
      </div>
    </div>
    <script
      src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script
      src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAbpyXETtBChmh6vKpHCyaqpmPIm-lzAkI",
      authDomain: "bitgame-70394.firebaseapp.com",
      databaseURL: "https://bitgame-70394-default-rtdb.firebaseio.com",
      projectId: "bitgame-70394",
      storageBucket: "bitgame-70394.firebasestorage.app",
      messagingSenderId: "796428704868",
      appId: "1:796428704868:web:6926c5650bec88ee0c1371",
      measurementId: "G-W7KQ98LNST"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>
    <script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>
    <script src="script.v1.4.js"></script>

    <div id="levelIntroModal" style="display:none" class="modal">
      <div class="modal-content">
        <h2 id="introTitle"></h2>
        <p id="introDesc"></p>
        <table id="truthTable" border="1" style="margin: 10px auto;"></table>
        <button id="startLevelBtn">ì‹œì‘í•˜ê¸°</button>
      </div>
    </div>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("service-worker.js");
        });
      }
    </script>

  </body>
</html>
